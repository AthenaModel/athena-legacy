# -*-Tcl-*-
#-----------------------------------------------------------------------
# TITLE:
#    010-scenario.test
#
# AUTHOR:
#    Will Duquette
#
# DESCRIPTION:
#    scenario(sim) tests.
#
#    This test suite tests the scenario(sim) mutators and queries
#
#    TBD: At present, it really only tests "scenario mutate reconcile".
#
#-----------------------------------------------------------------------

#-----------------------------------------------------------------------
# Test Suite
#
# The tests run in a namespace so as not to interfere with other
# test suites.

namespace eval ::athena_test::tests:: {
    #-------------------------------------------------------------------
    # Set up the test environment

    # Import tcltest(n)
    namespace import ::tcltest::*
    
    # Clean up after a test

    proc cleanup {} {
        # Clean up the test environment
        ted cleanup
    }

    #-------------------------------------------------------------------
    # mutate reconcile
    #
    # All we really need to test is that each mutate reconcile command
    # is called.
   

    test reconcile-1.1 {All entities are reconciled} -body {
        ted notifier bind ::nbrel    <Entity>
        ted notifier bind ::civgroup <Entity>
        ted notifier bind ::sat      <Entity>
        ted notifier bind ::rel      <Entity>
        ted notifier bind ::coop     <Entity>
        ted notifier bind ::attroe   <Entity>
        ted notifier bind ::defroe   <Entity>
        ted notifier bind ::scenario <Reconcile>

        ted create BLUE USAID NB1 SHIA

        scenario mutate reconcile

        nbhood mutate delete NB1

        scenario mutate reconcile

        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::civgroup <Entity> create SHIA}
        {::nbrel <Entity> create {NB1 NB1}}
        {::sat <Entity> create {SHIA AUT}}
        {::sat <Entity> create {SHIA SFT}}
        {::sat <Entity> create {SHIA CUL}}
        {::sat <Entity> create {SHIA QOL}}
        {::rel <Entity> create {BLUE BLUE}}
        {::rel <Entity> create {BLUE USAID}}
        {::rel <Entity> create {BLUE SHIA}}
        {::rel <Entity> create {USAID BLUE}}
        {::rel <Entity> create {USAID USAID}}
        {::rel <Entity> create {USAID SHIA}}
        {::rel <Entity> create {SHIA BLUE}}
        {::rel <Entity> create {SHIA USAID}}
        {::rel <Entity> create {SHIA SHIA}}
        {::coop <Entity> create {SHIA BLUE}}
        {::defroe <Entity> create {NB1 BLUE}}
        {::scenario <Reconcile>}
        {::nbrel <Entity> delete {NB1 NB1}}
        {::civgroup <Entity> delete SHIA}
        {::sat <Entity> delete {SHIA AUT}}
        {::sat <Entity> delete {SHIA SFT}}
        {::sat <Entity> delete {SHIA CUL}}
        {::sat <Entity> delete {SHIA QOL}}
        {::rel <Entity> delete {BLUE SHIA}}
        {::rel <Entity> delete {USAID SHIA}}
        {::rel <Entity> delete {SHIA BLUE}}
        {::rel <Entity> delete {SHIA USAID}}
        {::rel <Entity> delete {SHIA SHIA}}
        {::coop <Entity> delete {SHIA BLUE}}
        {::defroe <Entity> delete {NB1 BLUE}}
        {::scenario <Reconcile>}
    }


    test reconcile-1.2 {On undo: <Entity> create} -body {
        ted create BLUE USAID NB1 SHIA

        scenario mutate reconcile

        nbhood mutate delete NB1
        frcgroup mutate delete BLUE

        set undo [scenario mutate reconcile]

        ted notifier bind ::nbrel    <Entity>
        ted notifier bind ::civgroup <Entity>
        ted notifier bind ::sat      <Entity>
        ted notifier bind ::rel      <Entity>
        ted notifier bind ::coop     <Entity>
        ted notifier bind ::defroe  <Entity>
        ted notifier bind ::scenario <Reconcile>
        
        eval $undo
        
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::nbrel <Entity> create {NB1 NB1}}
        {::civgroup <Entity> create SHIA}
        {::sat <Entity> create {SHIA AUT}}
        {::sat <Entity> create {SHIA SFT}}
        {::sat <Entity> create {SHIA CUL}}
        {::sat <Entity> create {SHIA QOL}}
        {::rel <Entity> create {BLUE BLUE}}
        {::rel <Entity> create {BLUE USAID}}
        {::rel <Entity> create {BLUE SHIA}}
        {::rel <Entity> create {USAID BLUE}}
        {::rel <Entity> create {USAID SHIA}}
        {::rel <Entity> create {SHIA BLUE}}
        {::rel <Entity> create {SHIA USAID}}
        {::rel <Entity> create {SHIA SHIA}}
        {::coop <Entity> create {SHIA BLUE}}
        {::defroe <Entity> create {NB1 BLUE}}
    }

    #-------------------------------------------------------------------
    # Cleanup

    cleanupTests
}

namespace delete ::athena_test::tests::






