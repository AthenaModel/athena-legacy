# -*-Tcl-*-
#-----------------------------------------------------------------------
# TITLE:
#    020-ROE-ATTACK.test
#
# AUTHOR:
#    Will Duquette
#
# DESCRIPTION:
#    app_sim(1) ROE:ATTACK:* order tests.
#
#    This test suite tests the attroe-related orders.
#
#-----------------------------------------------------------------------

#-----------------------------------------------------------------------
# Test Suite
#
# The tests run in a namespace so as not to interfere with other
# test suites.

namespace eval ::athena_test::tests:: {
    #-------------------------------------------------------------------
    # Set up the test environment

    # Import tcltest(n)
    namespace import ::tcltest::*

    proc setup {} {
        ted create NB1 NB2 BLUE BRIT ALQ TAL
    }

    set blue_alq {
        n         NB1
        f         BLUE
        g         ALQ
        roe       ATTACK
        cooplimit 30
    }

    set blue_tal {
        n         NB1
        f         BLUE
        g         TAL
        roe       ATTACK
        cooplimit 40
    }

    set alq_blue {
        n         NB1
        f         ALQ
        g         BLUE
        roe       HIT_AND_RUN
        cooplimit 40
        rate      0.5
    }

    set tal_blue {
        n         NB1
        f         TAL
        g         BLUE
        roe       STAND_AND_FIGHT
        cooplimit 30
        rate      0.25
    }

    # Clean up after a test

    proc cleanup {} {
        # Clean up the test environment
        ted cleanup
        cif clear
    }

    #-------------------------------------------------------------------
    # ROE:ATTACK:UNIFORMED:CREATE

    test U-CREATE-1.1 {required parms} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:CREATE {}
    } -cleanup {
        cleanup
    } -result {
        n {required value}
        f {required value}
        g {required value}
        roe {required value}
        cooplimit {required value}
    }


    test U-CREATE-1.2 {n is not a nbhood} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:CREATE \
            [dict merge $blue_alq {n NONESUCH}]
    } -cleanup {
        cleanup
    } -result {
        n {Invalid neighborhood, should be one of: NB1, NB2}
    }


    test U-CREATE-1.3 {f is not a uniformed force group} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:CREATE \
            [dict merge $blue_alq {f ALQ}]
    } -cleanup {
        cleanup
    } -result {
        f {Invalid uniformed force group, should be one of: BLUE, BRIT}
    }


    test U-CREATE-1.4 {g is not a non-uniformed force group} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:CREATE \
            [dict merge $blue_alq {g BRIT}]
    } -cleanup {
        cleanup
    } -result {
        g {Invalid non-uniformed force group, should be one of: ALQ, TAL}
    }


    test U-CREATE-1.5 {n,f,g is already defined} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -cleanup {
        cleanup
    } -result {
        g {Group BLUE already has an ROE with group ALQ in NB1}
    }


    test U-CREATE-1.6 {Invalid ROE} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:CREATE \
            [dict merge $blue_alq {roe NONESUCH}]
    } -cleanup {
        cleanup
    } -result {
        roe {invalid value "NONESUCH", should be one of: DO_NOT_ATTACK, ATTACK}
    }


    test U-CREATE-1.7 {Non-numeric coop limit} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:CREATE \
            [dict merge $blue_alq {cooplimit NONESUCH}]
    } -cleanup {
        cleanup
    } -result {
        cooplimit {invalid value "NONESUCH", should be a real number in range 0.0, 100.0, or one of: AC, VC, C, MC, U, VU, NC}
    }


    test U-CREATE-1.8 {Coop limit out of range} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:CREATE \
            [dict merge $blue_alq {cooplimit -1}]
    } -cleanup {
        cleanup
    } -result {
        cooplimit {invalid value "-1", should be a real number in range 0.0, 100.0, or one of: AC, VC, C, MC, U, VU, NC}
    }


    test U-CREATE-2.1 {roe is created} -setup {
        setup
    } -body {
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_tal

        ted query {SELECT * FROM attroe_nfg}
    } -cleanup {
        cleanup
    } -result {
n   f    g   uniformed roe    cooplimit rate 
--- ---- --- --------- ------ --------- ---- 
NB1 BLUE ALQ 1         ATTACK 30.0           
NB1 BLUE TAL 1         ATTACK 40.0           
    }


    test U-CREATE-2.2 {Effects} -setup {
        setup
    } -body {
        ted notifier bind ::attroe <Entity>
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> create {NB1 BLUE ALQ}}
    }


    test U-CREATE-3.1 {undo effects} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -body {
        ted notifier bind ::attroe <Entity>
        cif undo -test
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> delete {NB1 BLUE ALQ}}
    }


    #-------------------------------------------------------------------
    # ROE:ATTACK:DELETE

    test DELETE-1.1 {required parms} -body {
        ted order -reject ROE:ATTACK:DELETE {}
    } -result {
        n {required value}
        f {required value}
        g {required value}
    }

    
    test DELETE-1.2 {unknown n,f,g} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:DELETE n NONESUCH1 f NONESUCH2 g NONESUCH3
    } -cleanup {
        cleanup
    } -result {
        n {Invalid neighborhood, should be one of: NB1, NB2}
        f {Invalid force group, should be one of: BLUE, BRIT, ALQ, TAL}
        g {Invalid force group, should be one of: BLUE, BRIT, ALQ, TAL}
    }


    test DELETE-1.3 {no such attroe} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:DELETE n NB1 f BLUE g ALQ
    } -cleanup {
        cleanup
    } -result {
        g {Group BLUE has no ROE for group ALQ in NB1.}
    }


    test DELETE-2.1 {Effects} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -body {
        ted notifier bind ::attroe <Entity>
        ted order ROE:ATTACK:DELETE n NB1 f BLUE g ALQ
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> delete {NB1 BLUE ALQ}}
    }


    test DELETE-3.1 {Undo effects} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
        ted order ROE:ATTACK:DELETE n NB1 f BLUE g ALQ
    } -body {
        ted notifier bind ::attroe <Entity>
        cif undo -test
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> create {NB1 BLUE ALQ}}
    }


    #-------------------------------------------------------------------
    # ROE:ATTACK:UNIFORMED:UPDATE

    test U-UPDATE-1.1 {required parms} -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE {}
    } -result {
        n {required value}
        f {required value}
        g {required value}
    }
    

    test U-UPDATE-1.2 {invalid n, f, g} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE \
            n NONESUCH f NONESUCH g NONESUCH
    } -cleanup {
        cleanup
    } -result {
        n {Invalid neighborhood, should be one of: NB1, NB2}
        f {Invalid uniformed force group, should be one of: BLUE, BRIT}
        g {Invalid non-uniformed force group, should be one of: ALQ, TAL}
    }


    test U-UPDATE-1.3 {undefined entity} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE \
            n NB1 f BLUE g ALQ
    } -cleanup {
        cleanup
    } -result {
        g {Group BLUE has no ROE for group ALQ in NB1.}
    }


    test U-UPDATE-1.4 {invalid roe} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE \
            n NB1 f BLUE g ALQ roe NONESUCH
    } -cleanup {
        cleanup
    } -result {
        roe {invalid value "NONESUCH", should be one of: DO_NOT_ATTACK, ATTACK}
    }


    test U-UPDATE-1.5 {non-numeric cooplimit} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE \
            n NB1 f BLUE g ALQ cooplimit NONESUCH
    } -cleanup {
        cleanup
    } -result {
        cooplimit {invalid value "NONESUCH", should be a real number in range 0.0, 100.0, or one of: AC, VC, C, MC, U, VU, NC}
    }


    test U-UPDATE-1.6 {cooplimit out of range} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE \
            n NB1 f BLUE g ALQ cooplimit -1
    } -cleanup {
        cleanup
    } -result {
        cooplimit {invalid value "-1", should be a real number in range 0.0, 100.0, or one of: AC, VC, C, MC, U, VU, NC}
    }


    test U-UPDATE-2.1 {attroe is updated} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -body {
        ted order ROE:ATTACK:UNIFORMED:UPDATE {
            n              NB1
            f              BLUE
            g              ALQ
            roe            DO_NOT_ATTACK
            cooplimit      20
        }

        ted query {SELECT * FROM attroe_nfg}
    } -cleanup {
        cleanup
    } -result {
n   f    g   uniformed roe           cooplimit rate 
--- ---- --- --------- ------------- --------- ---- 
NB1 BLUE ALQ 1         DO_NOT_ATTACK 20.0           
    }


    test U-UPDATE-2.2 {Effects} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -body {
        ted notifier bind ::attroe <Entity>
        ted order ROE:ATTACK:UNIFORMED:UPDATE \
            n NB1 f BLUE g ALQ roe DO_NOT_ATTACK
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> update {NB1 BLUE ALQ}}
    }


    test U-UPDATE-3.1 {undo undoes the change} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
        ted order ROE:ATTACK:UNIFORMED:UPDATE {
            n              NB1
            f              BLUE
            g              ALQ
            roe            DO_NOT_ATTACK
            cooplimit      20
        }
    } -body {
        ted notifier bind ::attroe <Entity>
        cif undo -test
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> update {NB1 BLUE ALQ}}
    }

    #-------------------------------------------------------------------
    # ROE:ATTACK:UNIFORMED:UPDATE:MULTI

    test U-UPDATE:MULTI-1.1 {required parms} -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE:MULTI {}
    } -result {
        ids {required value}
    }
    

    test U-UPDATE:MULTI-1.2 {invalid ids, bad nbhood} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE:MULTI \
            ids {{NONESUCH BLUE ALQ}}
    } -cleanup {
        cleanup
    } -result {
        ids {Invalid neighborhood, should be one of: NB1, NB2}
    }


    test U-UPDATE:MULTI-1.3 {invalid ids, bad group f} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE:MULTI \
            ids {{NB1 NONESUCH ALQ}}
    } -cleanup {
        cleanup
    } -result {
        ids {Invalid uniformed force group, should be one of: BLUE, BRIT}
    }


    test U-UPDATE:MULTI-1.4 {invalid ids, bad group g} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE:MULTI \
            ids {{NB1 BLUE NONESUCH}}
    } -cleanup {
        cleanup
    } -result {
        ids {Invalid non-uniformed force group, should be one of: ALQ, TAL}
    }


    test U-UPDATE:MULTI-1.5 {invalid ids, no entity} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE:MULTI \
            ids {{NB1 BLUE ALQ}}
    } -cleanup {
        cleanup
    } -result {
        ids {Group BLUE has no ROE for group ALQ in NB1.}
    }
    
    test U-UPDATE:MULTI-1.6 {invalid roe} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE:MULTI \
            ids {{NB1 BLUE ALQ}} roe NONESUCH
    } -cleanup {
        cleanup
    } -result {
        roe {invalid value "NONESUCH", should be one of: DO_NOT_ATTACK, ATTACK}
    }


    test U-UPDATE:MULTI-1.7 {invalid cooplimit} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
    } -body {
        ted order -reject ROE:ATTACK:UNIFORMED:UPDATE:MULTI \
            ids {{NB1 BLUE ALQ}} cooplimit NONESUCH
    } -cleanup {
        cleanup
    } -result {
        cooplimit {invalid value "NONESUCH", should be a real number in range 0.0, 100.0, or one of: AC, VC, C, MC, U, VU, NC}
    }



    test U-UPDATE:MULTI-2.1 {one entity of several is updated} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_tal
    } -body {
        ted notifier bind ::attroe <Entity>

        ted order ROE:ATTACK:UNIFORMED:UPDATE:MULTI {
            ids            {{NB1 BLUE ALQ}}
            roe            DO_NOT_ATTACK
            cooplimit      0.0
        }

        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> update {NB1 BLUE ALQ}}
    }


    test U-UPDATE:MULTI-2.2 {several attroe_nfg are updated} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_tal
    } -body {
        ted notifier bind ::attroe <Entity>

        ted order ROE:ATTACK:UNIFORMED:UPDATE:MULTI {
            ids            {{NB1 BLUE ALQ} {NB1 BLUE TAL}}
            roe            DO_NOT_ATTACK
            cooplimit      0.0
        }

        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> update {NB1 BLUE ALQ}}
        {::attroe <Entity> update {NB1 BLUE TAL}}
    }



    test U-UPDATE:MULTI-3.1 {undo effects} -setup {
        setup
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_alq
        ted order ROE:ATTACK:UNIFORMED:CREATE $blue_tal
        ted order ROE:ATTACK:UNIFORMED:UPDATE:MULTI {
            ids            {{NB1 BLUE ALQ} {NB1 BLUE TAL}}
            roe            DO_NOT_ATTACK
        }
    } -body {
        ted notifier bind ::attroe <Entity>
        cif undo -test
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> update {NB1 BLUE ALQ}}
        {::attroe <Entity> update {NB1 BLUE TAL}}
    }

    #-------------------------------------------------------------------
    # ROE:ATTACK:NONUNIFORMED:CREATE

    test N-CREATE-1.1 {required parms} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:CREATE {}
    } -cleanup {
        cleanup
    } -result {
        n {required value}
        f {required value}
        g {required value}
        roe {required value}
        cooplimit {required value}
        rate {required value}
    }


    test N-CREATE-1.2 {n is not a nbhood} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:CREATE \
            [dict merge $alq_blue {n NONESUCH}]
    } -cleanup {
        cleanup
    } -result {
        n {Invalid neighborhood, should be one of: NB1, NB2}
    }


    test N-CREATE-1.3 {f is not a non-uniformed force group} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:CREATE \
            [dict merge $alq_blue {f BLUE}]
    } -cleanup {
        cleanup
    } -result {
        f {Invalid non-uniformed force group, should be one of: ALQ, TAL}
    }


    test N-CREATE-1.4 {g is not a uniformed force group} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:CREATE \
            [dict merge $alq_blue {g ALQ}]
    } -cleanup {
        cleanup
    } -result {
        g {Invalid uniformed force group, should be one of: BLUE, BRIT}
    }


    test N-CREATE-1.5 {n,f,g is already defined} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -cleanup {
        cleanup
    } -result {
        g {Group ALQ already has an ROE with group BLUE in NB1}
    }


    test N-CREATE-1.6 {Invalid ROE} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:CREATE \
            [dict merge $alq_blue {roe NONESUCH}]
    } -cleanup {
        cleanup
    } -result {
        roe {invalid value "NONESUCH", should be one of: DO_NOT_ATTACK, HIT_AND_RUN, STAND_AND_FIGHT}
    }


    test N-CREATE-1.7 {Non-numeric coop limit} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:CREATE \
            [dict merge $alq_blue {cooplimit NONESUCH}]
    } -cleanup {
        cleanup
    } -result {
        cooplimit {invalid value "NONESUCH", should be a real number in range 0.0, 100.0, or one of: AC, VC, C, MC, U, VU, NC}
    }


    test N-CREATE-1.8 {Coop limit out of range} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:CREATE \
            [dict merge $alq_blue {cooplimit -1}]
    } -cleanup {
        cleanup
    } -result {
        cooplimit {invalid value "-1", should be a real number in range 0.0, 100.0, or one of: AC, VC, C, MC, U, VU, NC}
    }


    test N-CREATE-1.9 {Non-numeric rate} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:CREATE \
            [dict merge $alq_blue {rate NONESUCH}]
    } -cleanup {
        cleanup
    } -result {
        rate {invalid value "NONESUCH", should be a real number no less than 0.0}
    }


    test N-CREATE-1.10 {Rate out of range} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:CREATE \
            [dict merge $alq_blue {rate -1}]
    } -cleanup {
        cleanup
    } -result {
        rate {invalid value "-1", should be a real number no less than 0.0}
    }


    test N-CREATE-2.1 {roe is created} -setup {
        setup
    } -body {
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $tal_blue

        ted query {SELECT * FROM attroe_nfg}
    } -cleanup {
        cleanup
    } -result {
n   f   g    uniformed roe             cooplimit rate 
--- --- ---- --------- --------------- --------- ---- 
NB1 ALQ BLUE 0         HIT_AND_RUN     40.0      0.5  
NB1 TAL BLUE 0         STAND_AND_FIGHT 30.0      0.25 
    }


    test N-CREATE-2.2 {Effects} -setup {
        setup
    } -body {
        ted notifier bind ::attroe <Entity>
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> create {NB1 ALQ BLUE}}
    }


    test N-CREATE-3.1 {undo effects} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted notifier bind ::attroe <Entity>
        cif undo -test
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> delete {NB1 ALQ BLUE}}
    }


    #-------------------------------------------------------------------
    # ROE:ATTACK:NONUNIFORMED:UPDATE

    test N-UPDATE-1.1 {required parms} -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE {}
    } -result {
        n {required value}
        f {required value}
        g {required value}
    }
    

    test N-UPDATE-1.2 {invalid n, f, g} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE \
            n NONESUCH f NONESUCH g NONESUCH
    } -cleanup {
        cleanup
    } -result {
        n {Invalid neighborhood, should be one of: NB1, NB2}
        f {Invalid non-uniformed force group, should be one of: ALQ, TAL}
        g {Invalid uniformed force group, should be one of: BLUE, BRIT}
    }


    test N-UPDATE-1.3 {undefined entity} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE \
            n NB1 f ALQ g BLUE
    } -cleanup {
        cleanup
    } -result {
        g {Group ALQ has no ROE for group BLUE in NB1.}
    }


    test N-UPDATE-1.4 {invalid roe} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE \
            n NB1 f ALQ g BLUE roe NONESUCH
    } -cleanup {
        cleanup
    } -result {
        roe {invalid value "NONESUCH", should be one of: DO_NOT_ATTACK, HIT_AND_RUN, STAND_AND_FIGHT}
    }


    test N-UPDATE-1.5 {non-numeric cooplimit} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE \
            n NB1 f ALQ g BLUE cooplimit NONESUCH
    } -cleanup {
        cleanup
    } -result {
        cooplimit {invalid value "NONESUCH", should be a real number in range 0.0, 100.0, or one of: AC, VC, C, MC, U, VU, NC}
    }


    test N-UPDATE-1.6 {cooplimit out of range} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE \
            n NB1 f ALQ g BLUE cooplimit -1
    } -cleanup {
        cleanup
    } -result {
        cooplimit {invalid value "-1", should be a real number in range 0.0, 100.0, or one of: AC, VC, C, MC, U, VU, NC}
    }


    test N-UPDATE-1.7 {non-numeric rate} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE \
            n NB1 f ALQ g BLUE rate NONESUCH
    } -cleanup {
        cleanup
    } -result {
        rate {invalid value "NONESUCH", should be a real number no less than 0.0}
    }


    test N-UPDATE-1.8 {rate out of range} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE \
            n NB1 f ALQ g BLUE rate -1
    } -cleanup {
        cleanup
    } -result {
        rate {invalid value "-1", should be a real number no less than 0.0}
    }


    test N-UPDATE-2.1 {attroe is updated} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted order ROE:ATTACK:NONUNIFORMED:UPDATE {
            n              NB1
            f              ALQ
            g              BLUE
            roe            DO_NOT_ATTACK
            cooplimit      20
            rate           0.6
        }

        ted query {SELECT * FROM attroe_nfg}
    } -cleanup {
        cleanup
    } -result {
n   f   g    uniformed roe           cooplimit rate 
--- --- ---- --------- ------------- --------- ---- 
NB1 ALQ BLUE 0         DO_NOT_ATTACK 20.0      0.6  
    }


    test N-UPDATE-2.2 {Effects} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted notifier bind ::attroe <Entity>
        ted order ROE:ATTACK:NONUNIFORMED:UPDATE \
            n NB1 f ALQ g BLUE roe DO_NOT_ATTACK
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> update {NB1 ALQ BLUE}}
    }


    test N-UPDATE-3.1 {undo undoes the change} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
        ted order ROE:ATTACK:NONUNIFORMED:UPDATE {
            n              NB1
            f              ALQ
            g              BLUE
            roe            DO_NOT_ATTACK
            cooplimit      20
            rate           0.6
        }
    } -body {
        ted notifier bind ::attroe <Entity>
        cif undo -test
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> update {NB1 ALQ BLUE}}
    }

    #-------------------------------------------------------------------
    # ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI

    test N-UPDATE:MULTI-1.1 {required parms} -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI {}
    } -result {
        ids {required value}
    }
    

    test N-UPDATE:MULTI-1.2 {invalid ids, bad nbhood} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI \
            ids {{NONESUCH ALQ BLUE}}
    } -cleanup {
        cleanup
    } -result {
        ids {Invalid neighborhood, should be one of: NB1, NB2}
    }


    test N-UPDATE:MULTI-1.3 {invalid ids, bad group f} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI \
            ids {{NB1 NONESUCH BLUE}}
    } -cleanup {
        cleanup
    } -result {
        ids {Invalid non-uniformed force group, should be one of: ALQ, TAL}
    }


    test N-UPDATE:MULTI-1.4 {invalid ids, bad group g} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI \
            ids {{NB1 ALQ NONESUCH}}
    } -cleanup {
        cleanup
    } -result {
        ids {Invalid uniformed force group, should be one of: BLUE, BRIT}
    }


    test N-UPDATE:MULTI-1.5 {invalid ids, no entity} -setup {
        setup
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI \
            ids {{NB1 ALQ BLUE}}
    } -cleanup {
        cleanup
    } -result {
        ids {Group ALQ has no ROE for group BLUE in NB1.}
    }
    
    test N-UPDATE:MULTI-1.6 {invalid roe} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI \
            ids {{NB1 ALQ BLUE}} roe NONESUCH
    } -cleanup {
        cleanup
    } -result {
        roe {invalid value "NONESUCH", should be one of: DO_NOT_ATTACK, HIT_AND_RUN, STAND_AND_FIGHT}
    }


    test N-UPDATE:MULTI-1.7 {invalid cooplimit} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI \
            ids {{NB1 ALQ BLUE}} cooplimit NONESUCH
    } -cleanup {
        cleanup
    } -result {
        cooplimit {invalid value "NONESUCH", should be a real number in range 0.0, 100.0, or one of: AC, VC, C, MC, U, VU, NC}
    }


    test N-UPDATE:MULTI-1.8 {invalid rate} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
    } -body {
        ted order -reject ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI \
            ids {{NB1 ALQ BLUE}} rate NONESUCH
    } -cleanup {
        cleanup
    } -result {
        rate {invalid value "NONESUCH", should be a real number no less than 0.0}
    }



    test N-UPDATE:MULTI-2.1 {one entity of several is updated} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $tal_blue
    } -body {
        ted notifier bind ::attroe <Entity>

        ted order ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI {
            ids            {{NB1 ALQ BLUE}}
            roe            DO_NOT_ATTACK
            cooplimit      0.0
            rate           0.0
        }

        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> update {NB1 ALQ BLUE}}
    }


    test N-UPDATE:MULTI-2.2 {several attroe_nfg are updated} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $tal_blue
    } -body {
        ted notifier bind ::attroe <Entity>

        ted order ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI {
            ids            {{NB1 ALQ BLUE} {NB1 TAL BLUE}}
            roe            DO_NOT_ATTACK
            cooplimit      0.0
            rate           0.0
        }

        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> update {NB1 ALQ BLUE}}
        {::attroe <Entity> update {NB1 TAL BLUE}}
    }



    test N-UPDATE:MULTI-3.1 {undo effects} -setup {
        setup
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $alq_blue
        ted order ROE:ATTACK:NONUNIFORMED:CREATE $tal_blue
        ted order ROE:ATTACK:NONUNIFORMED:UPDATE:MULTI {
            ids            {{NB1 ALQ BLUE} {NB1 TAL BLUE}}
            roe            DO_NOT_ATTACK
        }
    } -body {
        ted notifier bind ::attroe <Entity>
        cif undo -test
        ted notifier received
    } -cleanup {
        cleanup
    } -result {
        {::attroe <Entity> update {NB1 ALQ BLUE}}
        {::attroe <Entity> update {NB1 TAL BLUE}}
    }


    #-------------------------------------------------------------------
    # Cleanup

    cleanupTests
}

namespace delete ::athena_test::tests::






