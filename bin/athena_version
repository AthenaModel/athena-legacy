#!/bin/sh
# -*-tcl-*-
# The next line restarts using tclsh \
exec tclsh8.5 "$0" "$@"

#-----------------------------------------------------------------------
# TITLE:
#    athena_version
#
# AUTHOR:
#    Will Duquette
#
# DESCRIPTION:
#    Athena: Version Switcher
#
#    This script is the launcher for the athena_version(1) application,
#    which is defined by the app_version(n) package.
#     
#-----------------------------------------------------------------------

#-----------------------------------------------------------------------
# Set up the auto_path, so that we can find the correct libraries.  
# In development, there might be directories loaded from TCLLIBPATH;
# strip them out.

# First, remove all TCLLIBPATH directories from the auto_path.

if {[info exists env(TCLLIBPATH)]} {
    set old_path $auto_path
    set auto_path [list]

    foreach dir $old_path {
        if {$dir ni $env(TCLLIBPATH)} {
            lappend auto_path $dir
        }
    }
}

# Next, get the Athena-specific directories.

set appdir  [file normalize [file dirname [info script]]]
set libdir  [file normalize [file join $appdir .. lib]]
set marsdir [file normalize [file join $appdir .. mars lib]]

# Add Athena libs to the new lib path.
lappend auto_path $marsdir $libdir

#-------------------------------------------------------------------
# Next, require Tcl

package require Tcl 8.5

#-----------------------------------------------------------------------
# Main Program 

# main argv
#
# argv       Command line arguments
#
# This is the main program; it is invoked at the bottom of the file.

proc main {argv} {
    # FIRST, load marsutil(n).  Don't import it;
    # leave that for the applications.

    package require marsutil

    # NEXT, require the application package
    package require app_version

    # NEXT, get the application directory in the host
    # file system.
    appdir init
    
    # NEXT, Invoke the app.
    app init $argv
}

#-----------------------------------------------------------------------
# Run the program

# FIRST, run the main routine, to set everything up.
main $argv



